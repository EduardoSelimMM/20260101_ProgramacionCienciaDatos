---
title: "Sesión 8"
format: html
editor: visual
---

# Dataframes

+ Los dataframes se muestran en un formato de tabla.

+ Los dataframes pueden contener diferentes tipos de datos en su interior. Por ejemplo, la primera columna puede ser de tipo `character`, la segunda y la tercera pueden ser `numeric` o `logical`.

+ Sin embargo, cada columna debe tener el mismo tipo de datos: es decir, una columna puede tener sólo número, sólo carácteres y incluso puede ser un dataframe que dentro de éste tenga dataframes.

+ ¿Cómo creamos dataframes?

+ Hay varias formas... como siempre

+ Una de las clásicas es con la función `data.frame()`

```{r}
mi_dataframe <- data.frame(
  Paciente = c("Ariel", "Susana", "Oscar", "Alex"),
  Pulso = c(100, 150, 120, 115),
  Edad = c(60, 30, 45, 28)
)

mi_dataframe
```
+ Veamos qué clase de objeto es el objeto `mi_dataframe`

```{r}
class(mi_dataframe)
```
+ También podemos ver qué estructa tiene mi dataframe

```{r}
str(mi_dataframe)
```

+ Atributos clásicos que queremos saber de un dataframe es cuantas columnas tiene y cuantos renglones

```{r}
dim(mi_dataframe)
```
+ Podemos querer sólo el número de renglones

```{r}
nrow(mi_dataframe)
```
+ o sólo el número de columnas

```{r}
ncol(mi_dataframe)
```
+ Podemos saber cuál es el nombre de nuestras columnas

```{r}
names(mi_dataframe)
```
+ R tiene una función para darte un pequeño resumen del contenido de un dataframe

```{r}
summary(mi_dataframe)
```

+ ¿Cómo accedo a las columnas de un dataframe?

+ Primera forma: Por el número de columna

```{r}
# Accedo a la primera columna de mi dataframe
mi_dataframe[1]
```
+ Una propiedad súper agradable de los dataframes es que puedes hacer hacer al NOMBRE de la(s) columna(s)

+ Segunda forma: Mediante el nombre de la columna

```{r}
mi_dataframe["Paciente"]
```
+ si quiero acceder a lo que está dentro de alguna columna ocupo la notación de [[.]]

```{r}
mi_dataframe[["Paciente"]]
```
+ Otra forma de acceder es con el operador `$`

```{r}
mi_dataframe$Paciente
```
+ Por supuesto, podemos acceder a más de una columna:

+ Primera forma:

```{r}
mi_dataframe[c("Paciente","Edad")]
```
+ Otra forma es indicando el número de las columnas que quiero

```{r}
mi_dataframe[c(2,3)] # quiero las columnas, 2 y 3
```
+ También puedo acceder a una celda en particular

```{r}
mi_dataframe[2,3] # quiero la entrada que está en el segundo renglón y tercer columna
```
+ Puedo acceder a subconjuntos de renglones y de columnas

```{r}
mi_dataframe[1:2,1:2] # los renglones de 1 a 2 y las columnas de 1 a 2
```

```{r}
mi_dataframe[c(1,3),c(2,3)] # Los renglones 1 y 3 y a las columnas 2  y 3
```
+ También se puede hacer por nombre

```{r}
mi_dataframe[3,c("Edad", "Pulso")] # renglón 3, de las columnas Edad y Pulso
```

```{r}
mi_dataframe[2:3,c("Edad", "Pulso")] # renglón 2 hasta 3, de las columnas Edad y Pulso
```

```{r}
mi_dataframe[c(1,3),c("Edad", "Pulso")] # renglón 1 y 3, de las columnas Edad y Pulso
```
+ ¿Cómo inserto nuevos renglones a un dataframe existente?

+ Una forma es con la función rbind(), i.e. apilando (poniendo uno encima de otro) por renglones

```{r}
nuevo_renglon <- c("Daniel", 110, 45)
```

```{r}
mi_dataframe <- rbind(mi_dataframe, nuevo_renglon) # Pego en la parte de abajo al nuevo renglón
```

+ Puedo insertar un renglón en una posición que yo quiera? Sí

```{r}
nuevo_renglon2 <- c("Eduardo", 120, 75)
```

```{r}
mi_dataframe
```

+ ¿Cómo creo nuevas columnas en un dataframe existente?

+ Una forma es con la función `cbind()` apilando pero ahora por columnas

```{r}
nueva_columna <- c(2,5,NA,2,1)
```

```{r}
# Aplico la función cbind()
mi_dataframe <- cbind(mi_dataframe, nueva_columna)
```

```{r}
mi_dataframe
```

+ Oye, pero que feo nombre tiene la nueva columna

```{r}
names(mi_dataframe)
```
+ Puedo cambiar el nombre de esa columna a uno que me guste más

```{r}
names(mi_dataframe)[4] <- "NumHijos" # De los nombres de mi dataframe quiero cambiar el 4to
```

```{r}
mi_dataframe
```

+ Ptra manera de crear nuevas columnas es insertándola y bautizándola al mismo tiempo con el operador `$`

```{r}
# Estoy definiendo una nueva columna que se llama Estatura y contiene esos números
mi_dataframe$Estatura <- c(180, 167, 171, 175, 159)
```

```{r}
mi_dataframe
```
+ También puedo convertir una matriz en un dataframe

```{r}
# Esta es la matriz que quiero convertir a dataframe
matriz <- matrix(1:12, ncol = 4)
matriz
```
+ Le aplico la función `as.data.frame`

```{r}
otro_df <- as.data.frame(matriz)
otro_df
```
+ ¿Qué tipo de objeto es este?

```{r}
class(otro_df)
```

+ Hay algunas librerías que además de funciones contienen datasets en forma de dataframes

+ En la librería {ggplot2movies} simplemente hay un dataframe con información de algunas películas

```{r}
library(ggplot2movies)
```

+ El dataframe en esta librería se llama `movies`

+ ¿De qué tipo es el objeto con nombre `movies`?

```{r}
class(movies)
```
+ ¿Cuántas columnas y cuántos renglones tiene este dataframe?

```{r}
dim(movies)
```

+ Tiene 58,788 renglones y 24 columnas

+ ¿Qué estructura tiene este dataframe?

```{r}
str(movies)
```
+ A todo esto... ¿qué información tiene ese dataframe?

```{r}
# Se me hace que tengo que pedir ayuda
help(movies)
```

+ Veamos un extracto de dicho dataframe.. para esto ocuparemos la función `head()`, nos muestra los primero 6 renglones del dataframe

```{r}
movies |> head()
```

+ ¿Qué pasa si quiero que me muestre una cantidad diferente de renglones?

```{r}
movies |> head(n = 10) # Le indico que quiero ver los primeros 10 renglones
```

+ ¿Qué creen que haga esta instrucción?

```{r}
movies |> tail()
```

+ Muestra los últimos 6 renglones del dataframe

+ Vamos a trabajar un poquito con este dataframe

```{r}
datos <- movies
```

```{r}
datos |> head(n = 10)
```

```{r}
datos |> tail(n = 10)
```

Una manera de acceder a un rango de renglones no necesariamente los últimos o los primeros es con la función `slice`

+ Como voy a ocupar un operador de pipa `%>%` (un hermano cercado del operado `|>`) de la librería {dplyr} tengo que mandar llamar a esa librería

```{r}
library(dplyr)
```

```{r}
datos %>% slice(25:42) # los renglones del 25 al 42
```

+ Ya que mencionamos la librería {dplyr}. Esta es una librería muy popular para trabajar con dataframes porque tiene una sintaxis super noble. Aunque tiene muchísimas funciones, las 5 básicas (que se conocen como "verbos del dplyr") son

+ arrange(): Ordena la tabla en función a alguna o algunas de las columnas
+ select(): Selecciona alguna o algunas columnas que el usuario le pida
+ filter(): Filtra los renglones que satisfacen alguna condición dada por el usuario
+ join() (left_join, inner_join, outer_join): Permite unir dataframes
+ group_by(): Agrupa el dataframe mediante algunas variables para poder hacer resumenes. Casi siempre viene acompañada de la función `summarize()`

# Dataframes in Python (Pandas)

+ Un `DataFrame` (de pandas) es una estructura de datos tabular (filas x columnas)
+ tabla SQL
+ data.frame de R
+ Sheet de Excel/Google Sheets
+ Conceptualmente un diccionario de columnas.
+ Cada columna tiene un nombre y un tipo de datos, y cada fila tiene un índice.
+ Bidimensional (filas y columnas)
+ Columnas etiquetadas
+ Indexación flexible

```{r}
#install.packages("reticulate")
library(reticulate)
# Se crea un  virtual environment
virtualenv_create("myenv") 
# Se indica que en esta sesión de R
# Se usará en enviroment 'myenv'
use_virtualenv("myenv", required = TRUE) 
```

```{r}
#py_install("pandas")
```

```{python}
import pandas as pd
#Hablar sobre la convención estándar pd
```

```{python}
mi_df = pd.DataFrame({
    "nombre": ["Ana", "Luis", "María"],
    "edad": [30, 25, 40],
    "ciudad": ["CDMX", "MTY", "GDL"]
})
mi_df
```

```{python}
mi_df = pd.DataFrame([
    {"nombre": "Ana", "edad": 30},
    {"nombre": "Luis", "edad": 25}
])
mi_df
```

```{python}
mi_df = pd.DataFrame(
    [[1, 2], [3, 4]],
    columns=["A", "B"]
)
mi_df
```

```{python}
#pd.read_csv("archivo.csv")
#pd.read_excel("archivo.xlsx")
#pd.read_parquet("archivo.parquet")
```

```{python}
mi_df_externo = pd.read_csv("NetflixDailyTop10.csv")
```

```{python}
mi_df_externo
```

```{python}
mi_df = pd.DataFrame({
    "nombre": [
    "Ana", "Luis", "María", "Carlos", "Sofía",
    "Jorge", "Lucía", "Miguel", "Paula", "Andrés",
    "Elena", "Raúl", "Valeria", "Diego", "Carmen"
],
    "edad": [
    18, 22, 25, 29, 31,
    34, 37, 40, 43, 45,
    48, 50, 53, 56, 60
],
    "ciudad": [
    "CDMX", "NL", "JAL", "QRO", "PUE",
    "JAL", "SON", "CHIH", "YUC", "OAX",
    "GTO", "SLP", "CDMX", "VER", "AGS"
]
})
mi_df
```

```{python}
mi_df.shape
# (filas, columnas)
```

```{python}
# Nombres de columnas
mi_df.columns
```

-   **OJO:** `object` no es un tipo real, suele significar "mezcla o string".

```{python}
# Índices de las filas
mi_df.index
```

```{python}
# tipo de cada columna
mi_df.dtypes
```

```{python}
mi_df.head()
```

```{python}
mi_df.tail()
```

```{python}
mi_df.info()
```

```{python}
mi_df.describe()
```

```{python}
mi_df.describe(include = "object")
```

```{python}
mi_df.describe(include = "all")
```

```{python}
mi_df["edad"]
```

```{python}
mi_df.edad
```

```{python}
mi_df.loc[0]
```

```{python}
mi_df.loc[0, "edad"]
```

```{python}
mi_df.iloc[0, 1]
```

```{python}
mi_df[["nombre", "edad"]]
```

```{python}
mi_df["edad_doble"] = mi_df["edad"] * 2
```

```{python}
mi_df
```

```{python}
mi_df[mi_df["edad"] > 30]
```

```{python}
mi_df[(mi_df["edad"] > 25) & (mi_df["ciudad"] == "CDMX")]
```

```{python}
mi_df["mayor_edad"] = mi_df["edad"] >= 18
```

```{python}
mi_df
```

```{python}
mi_df.loc[mi_df["nombre"] == "Ana", "edad"] = 31
```

```{python}
mi_df
```
